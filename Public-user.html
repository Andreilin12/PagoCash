<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cliente - Sistema de Pr√©stamos</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    :root {
      --primary-color: #15a086;
      --primary-dark: #127c68;
      --secondary-color: #2c3e50;
      --background-color: #2c3e50;
      --text-color: #ffffff;
      --text-light: #a8a8a8;
      --border-color: #4a5e74;
      --card-bg: #34495e;
      --danger-color: #e74c3c;
      --warning-color: #f39c12;
      --success-color: #2ecc71;
      --info-color: #3498db;
      --light-background: #f5f5f5;
      --light-text: #333;
      --light-card: #ffffff;
      --light-border: #ddd;
      --font-size: 1rem;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Roboto', sans-serif;
      background-color: var(--background-color);
      color: var(--text-color);
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      transition: background-color 0.3s, color 0.3s;
      font-size: var(--font-size);
      overflow-x: hidden;
    }

    body.light-theme {
      --background-color: var(--light-background);
      --secondary-color: var(--light-card);
      --card-bg: var(--light-card);
      --text-color: var(--light-text);
      --text-light: #666;
      --border-color: var(--light-border);
    }

    body.font-small { --font-size: 0.9rem; }
    body.font-medium { --font-size: 1rem; }
    body.font-large { --font-size: 1.1rem; }

    /* Login Section */
    #login-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      background: linear-gradient(135deg, var(--secondary-color) 0%, var(--primary-color) 100%);
      padding: 1rem;
      animation: gradientShift 10s ease infinite;
      background-size: 200% 200%;
    }

    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .login-container {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(12px);
      border-radius: 20px;
      padding: 2.5rem;
      width: 100%;
      max-width: 400px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      animation: slideIn 0.5s ease;
    }

    .login-container:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 50px rgba(0, 0, 0, 0.4);
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .login-logo {
      display: block;
      margin: 0 auto 2rem;
      width: 140px;
      height: auto;
      filter: drop-shadow(0 4px 10px rgba(0, 0, 0, 0.2));
      animation: pulseLogo 2s ease infinite;
    }

    @keyframes pulseLogo {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    .login-title {
      text-align: center;
      margin-bottom: 2rem;
      color: var(--text-color);
      font-size: 2rem;
      font-weight: 700;
      text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    }

    .form-group {
      margin-bottom: 1.5rem;
      position: relative;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      color: var(--text-light);
      font-weight: 500;
      transition: color 0.3s ease;
    }

    .form-control {
      width: 100%;
      padding: 0.8rem;
      border: none;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.1);
      color: var(--text-color);
      font-size: 1rem;
      transition: all 0.3s ease;
    }

    .form-control:focus {
      outline: none;
      box-shadow: 0 0 10px var(--primary-color);
      background: rgba(255, 255, 255, 0.15);
    }

    .btn {
      background: var(--primary-color);
      color: var(--text-color);
      border: none;
      border-radius: 10px;
      padding: 0.8rem 1.5rem;
      cursor: pointer;
      font-size: 1rem;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      width: 100%;
    }

    .btn i {
      margin-right: 8px;
    }

    .btn::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      transition: width 0.4s ease, height 0.4s ease;
    }

    .btn:hover::after {
      width: 300px;
      height: 300px;
    }

    .btn:hover {
      background: var(--primary-dark);
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    }

    .btn:active {
      transform: translateY(0);
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    }

    /* Custom File Upload Button */
    .file-upload-btn {
      background: var(--card-bg);
      color: var(--primary-color);
      border: 2px solid var(--primary-color);
      border-radius: 50%;
      width: 60px;
      height: 60px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      transition: all 0.3s ease;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      position: relative;
      overflow: hidden;
    }

    .file-upload-btn:hover {
      transform: scale(1.15);
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
      background: var(--primary-color);
      color: var(--text-color);
    }

    .file-upload-btn input[type="file"] {
      display: none;
    }

    .file-upload-btn::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      transition: width 0.4s ease, height 0.4s ease;
    }

    .file-upload-btn:hover::after {
      width: 100px;
      height: 100px;
    }

    /* Client Section */
    #client-section {
      display: none;
      flex: 1;
      padding-bottom: 100px;
    }

    .header-client {
      background: var(--secondary-color);
      padding: 1.5rem;
      text-align: center;
      position: sticky;
      top: 0;
      z-index: 10;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      border-bottom: 1px solid var(--border-color);
      animation: slideDown 0.5s ease;
    }

    @keyframes slideDown {
      from { transform: translateY(-20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .client-profile {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 1rem;
    }

    .client-avatar {
      width: 90px;
      height: 90px;
      border-radius: 50%;
      background: var(--primary-color);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 1rem;
      font-size: 2.5rem;
      color: var(--text-color);
      object-fit: cover;
      border: 3px solid var(--primary-color);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .client-avatar:hover {
      transform: scale(1.1);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    }

    .client-name {
      font-size: 1.5rem;
      font-weight: 600;
    }

    .client-id {
      color: var(--text-light);
      font-size: 0.9rem;
    }

    .main-container-client {
      padding: 1rem;
      max-width: 600px;
      margin: 0 auto;
    }

    .section {
      display: none;
      animation: fadeInSection 0.5s ease;
    }

    .section.active {
      display: block;
    }

    @keyframes fadeInSection {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .card {
      background: var(--card-bg);
      border-radius: 20px;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
    }

    .card-title {
      color: var(--primary-color);
      margin-bottom: 1rem;
      font-size: 1.4rem;
      font-weight: 600;
    }

    .loan-balance {
      text-align: center;
      font-size: 2.8rem;
      font-weight: 700;
      color: var(--primary-color);
      margin-bottom: 1rem;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .late-payment-message {
      text-align: center;
      color: var(--danger-color);
      font-size: 1rem;
      margin-top: 0.5rem;
      animation: shake 0.5s ease;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }

    .progress-bar {
      height: 12px;
      background: var(--border-color);
      border-radius: 6px;
      overflow: hidden;
      margin: 1rem 0;
    }

    .progress-fill {
      height: 100%;
      background: var(--success-color);
      transition: width 0.5s ease;
      box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.2);
    }

    .loan-details-btn {
      margin-top: 1rem;
      background: var(--info-color);
    }

    .loan-details-btn:hover {
      background: #2980b9;
    }

    .loan-summary-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.75rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid var(--border-color);
    }

    .loan-summary-item:last-child {
      border-bottom: none;
    }

    .loan-detail-label {
      color: var(--text-light);
      font-weight: 500;
    }

    .payment-history {
      max-height: 400px;
      overflow-y: auto;
      padding-right: 0.5rem;
    }

    .payment-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.8rem;
      border-radius: 10px;
      margin-bottom: 0.5rem;
      background: rgba(255, 255, 255, 0.05);
      transition: background 0.3s ease, transform 0.3s ease;
    }

    .payment-item:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: translateX(5px);
    }

    .payment-amount {
      color: var(--success-color);
      font-weight: 600;
    }

    .payment-date {
      font-size: 0.85rem;
      color: var(--text-light);
    }

    .payment-type {
      font-size: 0.85rem;
      padding: 0.3rem 0.7rem;
      border-radius: 6px;
      background: rgba(52, 152, 219, 0.2);
    }

    .payment-type.capital {
      background: rgba(46, 204, 113, 0.2);
    }

    .payment-type.interest {
      background: rgba(241, 196, 15, 0.2);
    }

    .payment-type.late {
      background: rgba(231, 76, 60, 0.2);
    }

    .search-bar {
      margin-bottom: 1rem;
      display: flex;
      gap: 0.5rem;
    }

    .search-bar input {
      flex: 1;
      padding: 0.6rem;
      border-radius: 10px;
      border: none;
      background: rgba(255, 255, 255, 0.1);
      color: var(--text-color);
      transition: all 0.3s ease;
    }

    .search-bar input:focus {
      background: rgba(255, 255, 255, 0.15);
      box-shadow: 0 0 10px var(--primary-color);
    }

    .search-bar select {
      padding: 0.6rem;
      border-radius: 10px;
      border: none;
      background: var(--primary-color);
      color: var(--text-color);
      cursor: pointer;
    }

    /* Profile Section */
    .profile-info {
      margin-top: 1rem;
    }

    .info-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 1rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border-color);
    }

    .info-label {
      color: var(--text-light);
      font-weight: 500;
    }

    .info-value {
      text-align: right;
      max-width: 60%;
    }

    .avatar-selector {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
      gap: 1rem;
      margin: 1rem 0;
      max-height: 300px;
      overflow-y: auto;
      padding: 1rem;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 15px;
      box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.2);
    }

    .avatar-option {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      cursor: pointer;
      background: var(--card-bg);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      color: var(--primary-color);
      border: 2px solid transparent;
      transition: all 0.3s ease;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }

    .avatar-option:hover {
      transform: scale(1.15);
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
      border-color: var(--success-color);
    }

    .avatar-option.selected {
      border: 3px solid var(--success-color);
      transform: scale(1.1);
      background: var(--primary-color);
      color: var(--text-color);
    }

    /* Documents Section */
    .document-list {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1rem;
    }

    .document-item {
      background: rgba(255, 255, 255, 0.05);
      padding: 1rem;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      transition: all 0.3s ease;
    }

    .document-item:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: translateY(-3px);
    }

    .document-icon {
      font-size: 1.6rem;
      margin-right: 1rem;
      color: var(--primary-color);
    }

    .document-name {
      flex: 1;
      font-size: 0.9rem;
    }

    .document-action {
      color: var(--primary-color);
      cursor: pointer;
      font-size: 1.2rem;
      transition: transform 0.3s ease;
    }

    .document-action:hover {
      transform: scale(1.2);
    }

    /* Settings Section */
    .settings-option {
      margin-bottom: 1.5rem;
    }

    .settings-option label {
      display: block;
      margin-bottom: 0.5rem;
      color: var(--text-light);
      font-weight: 500;
    }

    .theme-selector {
      display: flex;
      gap: 0.7rem;
      flex-wrap: wrap;
    }

    .theme-option {
      padding: 0.6rem 1.2rem;
      border-radius: 10px;
      cursor: pointer;
      background: var(--primary-color);
      color: var(--text-color);
      transition: all 0.3s ease;
      font-size: 0.9rem;
    }

    .theme-option:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    .theme-option.selected {
      background: var(--success-color);
      transform: translateY(-2px);
    }

    .color-picker {
      padding: 0.5rem;
      border-radius: 10px;
      border: none;
      width: 100%;
      height: 50px;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    .settings-toggle {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .settings-toggle input {
      display: none;
    }

    .settings-toggle label {
      padding: 0.5rem 1rem;
      border-radius: 10px;
      background: var(--primary-color);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .settings-toggle input:checked + label {
      background: var(--success-color);
    }

    /* Bottom Navigation */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: var(--secondary-color);
      display: flex;
      justify-content: space-around;
      padding: 0.8rem 0;
      box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
      z-index: 100;
      border-top: 1px solid var(--border-color);
      transition: transform 0.3s ease;
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      color: var(--text-light);
      text-decoration: none;
      font-size: 0.8rem;
      padding: 0.6rem;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      width: 60px;
    }

    .nav-item i {
      font-size: 1.8rem;
      margin-bottom: 0.3rem;
      transition: transform 0.3s ease, color 0.3s ease;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      padding: 0.5rem;
    }

    .nav-item:hover i {
      transform: scale(1.2);
      color: var(--primary-color);
      box-shadow: 0 0 10px var(--primary-color);
    }

    .nav-item.active {
      color: var(--primary-color);
    }

    .nav-item.active i {
      animation: pulseNav 1s ease infinite;
      color: var(--primary-color);
      background: rgba(21, 160, 134, 0.2);
    }

    @keyframes pulseNav {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.15); }
    }

    .nav-item span {
      font-size: 0.7rem;
      text-transform: uppercase;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      justify-content: center;
      align-items: center;
      z-index: 1000;
      animation: fadeInModal 0.3s ease;
    }

    .modal.active {
      display: flex;
    }

    @keyframes fadeInModal {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .modal-content {
      background: var(--secondary-color);
      padding: 2rem;
      border-radius: 20px;
      width: 90%;
      max-width: 500px;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      border: 1px solid var(--border-color);
      position: relative;
      animation: slideUpModal 0.3s ease;
    }

    @keyframes slideUpModal {
      from { transform: translateY(50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .modal-title {
      margin-bottom: 1.5rem;
      color: var(--primary-color);
      text-align: center;
      font-size: 1.5rem;
      font-weight: 600;
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 1rem;
      margin-top: 1.5rem;
    }

    .btn-success {
      background: var(--success-color);
    }

    .btn-success:hover {
      background: #27ae60;
    }

    .btn-danger {
      background: var(--danger-color);
    }

    .btn-danger:hover {
      background: #c0392b;
    }

    .btn-info {
      background: var(--info-color);
    }

    .btn-info:hover {
      background: #2980b9;
    }

    .receipt-preview {
      background: #fff;
      padding: 1rem;
      border-radius: 10px;
      margin-bottom: 1rem;
      color: #000;
      font-family: 'Roboto', sans-serif;
      font-size: 0.9rem;
    }

    .receipt-preview h3 {
      text-align: center;
      margin-bottom: 1rem;
      color: #333;
    }

    .receipt-preview p {
      margin: 0.5rem 0;
    }

    /* Alerts */
    .alert {
      padding: 1rem;
      border-radius: 10px;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      animation: slideInAlert 0.5s ease;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    .alert-warning {
      background: rgba(243, 156, 18, 0.2);
      border-left: 5px solid var(--warning-color);
    }

    .alert-danger {
      background: rgba(231, 76, 60, 0.2);
      border-left: 5px solid var(--danger-color);
    }

    .alert-success {
      background: rgba(46, 204, 113, 0.2);
      border-left: 5px solid var(--success-color);
    }

    .alert i {
      margin-right: 0.5rem;
    }

    @keyframes slideInAlert {
      from { transform: translateX(-20px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    /* Loading Spinner */
    .spinner {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      z-index: 2000;
      justify-content: center;
      align-items: center;
    }

    .spinner.active {
      display: flex;
    }

    .spinner-icon {
      width: 60px;
      height: 60px;
      border: 6px solid transparent;
      border-top-color: var(--primary-color);
      border-right-color: var(--primary-color);
      border-radius: 50%;
      animation: spin 1s ease-in-out infinite, glowSpinner 1.5s ease infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    @keyframes glowSpinner {
      0%, 100% { box-shadow: 0 0 10px var(--primary-color); }
      50% { box-shadow: 0 0 20px var(--primary-color); }
    }

    /* Responsive Design */
    @media (max-width: 480px) {
      .login-container {
        padding: 1.5rem;
        max-width: 90%;
      }

      .main-container-client {
        padding: 0.5rem;
      }

      .card {
        padding: 1rem;
      }

      .bottom-nav {
        padding: 0.6rem 0;
      }

      .nav-item {
        width: 50px;
        font-size: 0.65rem;
      }

      .nav-item i {
        font-size: 1.6rem;
        padding: 0.4rem;
      }

      .modal-content {
        width: 95%;
        padding: 1.5rem;
      }

      .loan-balance {
        font-size: 2rem;
      }

      .client-avatar {
        width: 80px;
        height: 80px;
      }

      .avatar-option, .file-upload-btn {
        width: 50px;
        height: 50px;
        font-size: 1.8rem;
      }
    }

    @media (max-width: 360px) {
      .nav-item span {
        display: none;
      }

      .nav-item i {
        font-size: 1.4rem;
      }
    }
  </style>
</head>
<body>
  <!-- Login Section -->
  <section id="login-section">
    <div class="login-container">
      <div class="spinner" id="loginSpinner">
        <div class="spinner-icon"></div>
      </div>
      <img src="logo.png" alt="Sistema de Pr√©stamos Logo" class="login-logo">
      <h1 class="login-title">Bienvenido</h1>
      <form id="loginForm">
        <div class="form-group">
          <label for="loginUsername">Nombre de Usuario</label>
          <input type="text" id="loginUsername" class="form-control" required aria-label="Nombre de usuario">
        </div>
        <div class="form-group">
          <label for="loginPin">PIN (4 d√≠gitos)</label>
          <input type="password" id="loginPin" class="form-control" minlength="4" maxlength="4" pattern="\d{4}" required aria-label="PIN de 4 d√≠gitos">
        </div>
        <button type="submit" class="btn">
          <i class="fas fa-sign-in-alt"></i> <span data-lang="login">Iniciar Sesi√≥n</span>
        </button>
      </form>
      <div id="loginAlert" class="alert alert-danger" style="display: none;">
        <i class="fas fa-exclamation-circle"></i>
        <span id="loginAlertMessage"></span>
      </div>
    </div>
  </section>

  <!-- Client Section -->
  <section id="client-section">
    <div class="header-client">
      <div class="client-profile">
        <div id="clientAvatar" class="client-avatar"><i class="fas fa-user"></i></div>
        <h2 class="client-name" id="clientName">Nombre del Cliente</h2>
        <span class="client-id" id="clientId">ID: 000-0000000-0</span>
      </div>
    </div>

    <div class="main-container-client">
      <!-- Summary Section -->
      <div id="summary-section" class="section active">
        <div class="card">
          <div id="latePaymentAlert" class="alert alert-danger" style="display: none;">
            <i class="fas fa-exclamation-circle"></i>
            <span id="latePaymentMessage"></span>
          </div>
          <h3 class="card-title" data-lang="loan_balance">Saldo Pendiente</h3>
          <div class="loan-balance" id="loanBalance">$0.00</div>
          <div class="late-payment-message" id="latePaymentText" style="display: none;"></div>
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: 0%;"></div>
          </div>
          <button class="btn btn-info loan-details-btn" id="detailsBtn">
            <i class="fas fa-info-circle"></i> <span data-lang="view_details">Ver Detalles</span>
          </button>
        </div>
        <div class="card">
          <h3 class="card-title" data-lang="loan_progress">Progreso del Pr√©stamo</h3>
          <div id="loanProgress">
            <p id="progressText" data-lang="loading_progress">Cargando progreso...</p>
          </div>
        </div>
      </div>

      <!-- History Section -->
      <div id="history-section" class="section">
        <div class="card">
          <h3 class="card-title" data-lang="payment_history">Historial de Pagos</h3>
          <div class="search-bar">
            <input type="text" id="historySearch" placeholder="Buscar por fecha (dd/mm/aaaa)" aria-label="Buscar pagos">
            <select id="historyFilter" aria-label="Filtrar por tipo de pago">
              <option value="all" data-lang="all">Todos</option>
              <option value="full" data-lang="full">Completo</option>
              <option value="capital" data-lang="capital">Capital</option>
              <option value="interest" data-lang="interest">Inter√©s</option>
              <option value="late" data-lang="late">Con Mora</option>
            </select>
          </div>
          <div class="payment-history" id="paymentHistory">
            <p data-lang="loading_history">Cargando historial de pagos...</p>
          </div>
        </div>
      </div>

      <!-- Profile Section -->
      <div id="profile-section" class="section">
        <div class="card">
          <h3 class="card-title" data-lang="my_profile">Mi Perfil</h3>
          <div class="profile-info">
            <div class="info-item">
              <span class="info-label" data-lang="full_name">Nombre completo:</span>
              <span class="info-value" id="profileName">-</span>
            </div>
            <div class="info-item">
              <span class="info-label" data-lang="id">Identificaci√≥n:</span>
              <span class="info-value" id="profileId">-</span>
            </div>
            <div class="info-item">
              <span class="info-label" data-lang="phone">Tel√©fono:</span>
              <span class="info-value" id="profilePhone">-</span>
            </div>
            <div class="info-item">
              <span class="info-label" data-lang="address">Direcci√≥n:</span>
              <span class="info-value" id="profileAddress">-</span>
            </div>
            <div class="info-item">
              <span class="info-label" data-lang="nationality">Nacionalidad:</span>
              <span class="info-value" id="profileNationality">-</span>
            </div>
            <div class="info-item">
              <span class="info-label" data-lang="reference">Referencia personal:</span>
              <span class="info-value" id="profileReference">-</span>
            </div>
          </div>
          <button class="btn btn-info" id="changeAvatarBtn">
            <i class="fas fa-camera"></i> <span data-lang="change_profile_picture">Cambiar Foto de Perfil</span>
          </button>
          <button class="btn btn-info" id="changePasswordBtn">
            <i class="fas fa-key"></i> <span data-lang="change_password">Cambiar Contrase√±a</span>
          </button>
          <button class="btn btn-danger" id="logoutBtn">
            <i class="fas fa-sign-out-alt"></i> <span data-lang="logout">Cerrar Sesi√≥n</span>
          </button>
        </div>
      </div>

      <!-- Documents Section -->
      <div id="documents-section" class="section">
        <div class="card">
          <h3 class="card-title" data-lang="my_documents">Mis Documentos</h3>
          <div id="documentsAlert" class="alert alert-warning" style="display: none;">
            <i class="fas fa-exclamation-circle"></i>
            <span id="documentsAlertMessage" data-lang="no_documents">No hay documentos disponibles</span>
          </div>
          <div class="document-list" id="documentList"></div>
        </div>
      </div>

      <!-- Settings Section -->
      <div id="settings-section" class="section">
        <div class="card">
          <h3 class="card-title" data-lang="settings">Configuraci√≥n</h3>
          <div class="settings-option">
            <label data-lang="app_theme">Tema de la Aplicaci√≥n</label>
            <div class="theme-selector">
              <div class="theme-option" data-theme="dark" data-lang="dark">Oscuro</div>
              <div class="theme-option" data-theme="light" data-lang="light">Claro</div>
              <div class="theme-option" data-theme="custom" data-lang="custom">Personalizado</div>
            </div>
          </div>
          <div class="settings-option" id="customColorContainer" style="display: none;">
            <label data-lang="custom_color">Color Personalizado</label>
            <input type="color" id="customColorPicker" class="color-picker" value="#15a086">
          </div>
          <div class="settings-option">
            <label data-lang="language">Idioma</label>
            <select id="languageSelector" class="form-control">
              <option value="es" data-lang="spanish">Espa√±ol</option>
              <option value="en" data-lang="english">English</option>
            </select>
          </div>
          <div class="settings-option">
            <label data-lang="notifications">Notificaciones</label>
            <div class="settings-toggle">
              <input type="checkbox" id="emailNotifications">
              <label for="emailNotifications" data-lang="email_notifications">Notificaciones por Email</label>
            </div>
            <div class="settings-toggle">
              <input type="checkbox" id="smsNotifications">
              <label for="smsNotifications" data-lang="sms_notifications">Notificaciones por SMS</label>
            </div>
          </div>
          <div class="settings-option">
            <label data-lang="font_size">Tama√±o de Fuente</label>
            <select id="fontSizeSelector" class="form-control">
              <option value="small" data-lang="small">Peque√±o</option>
              <option value="medium" data-lang="medium">Mediano</option>
              <option value="large" data-lang="large">Grande</option>
            </select>
          </div>
          <div class="settings-option">
            <label data-lang="currency">Formato de Moneda</label>
            <select id="currencySelector" class="form-control">
              <option value="USD" data-lang="usd">USD</option>
              <option value="DOP" data-lang="dop">DOP</option>
            </select>
          </div>
          <button class="btn btn-success" id="saveSettingsBtn">
            <i class="fas fa-save"></i> <span data-lang="save_settings">Guardar Configuraci√≥n</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
      <a class="nav-item active" data-section="summary">
        <i class="fas fa-home"></i>
        <span data-lang="home">Inicio</span>
      </a>
      <a class="nav-item" data-section="history">
        <i class="fas fa-history"></i>
        <span data-lang="history">Historial</span>
      </a>
      <a class="nav-item" data-section="profile">
        <i class="fas fa-user"></i>
        <span data-lang="profile">Perfil</span>
      </a>
      <a class="nav-item" data-section="documents">
        <i class="fas fa-file-alt"></i>
        <span data-lang="documents">Documentos</span>
      </a>
      <a class="nav-item" data-section="settings">
        <i class="fas fa-cog"></i>
        <span data-lang="settings">Ajustes</span>
      </a>
    </div>
  </section>

  <!-- Details Modal -->
  <div class="modal" id="detailsModal">
    <div class="modal-content">
      <h3 class="modal-title" data-lang="loan_details">Detalles del Pr√©stamo</h3>
      <div id="loanDetailsContent"></div>
      <div class="modal-footer">
        <button class="btn btn-info" onclick="closeModal()" data-lang="close">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- Avatar Selection Modal -->
  <div class="modal" id="avatarModal">
    <div class="modal-content">
      <h3 class="modal-title" data-lang="select_profile_picture">Seleccionar Foto de Perfil</h3>
      <div class="avatar-selector" id="avatarSelector"></div>
      <div class="form-group">
        <label data-lang="upload_image">Subir Imagen</label>
        <label class="file-upload-btn">
          <i class="fas fa-camera"></i>
          <input type="file" id="profileImageUpload" accept="image/*" aria-label="Subir imagen de perfil">
        </label>
      </div>
      <div class="modal-footer">
        <button class="btn btn-success" id="saveAvatarBtn" data-lang="save">Guardar</button>
        <button class="btn btn-danger" onclick="closeModal()" data-lang="cancel">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- Change Password Modal -->
  <div class="modal" id="passwordModal">
    <div class="modal-content">
      <h3 class="modal-title" data-lang="change_password">Cambiar Contrase√±a</h3>
      <form id="passwordForm">
        <div class="form-group">
          <label for="currentPin" data-lang="current_pin">PIN Actual</label>
          <input type="password" id="currentPin" class="form-control" minlength="4" maxlength="4" pattern="\d{4}" required aria-label="PIN actual">
        </div>
        <div class="form-group">
          <label for="newPin" data-lang="new_pin">Nuevo PIN</label>
          <input type="password" id="newPin" class="form-control" minlength="4" maxlength="4" pattern="\d{4}" required aria-label="Nuevo PIN">
        </div>
        <div class="form-group">
          <label for="confirmPin" data-lang="confirm_pin">Confirmar Nuevo PIN</label>
          <input type="password" id="confirmPin" class="form-control" minlength="4" maxlength="4" pattern="\d{4}" required aria-label="Confirmar nuevo PIN">
        </div>
        <div id="passwordAlert" class="alert alert-danger" style="display: none;">
          <i class="fas fa-exclamation-circle"></i>
          <span id="passwordAlertMessage"></span>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-success" data-lang="save">Guardar</button>
          <button type="button" class="btn btn-danger" onclick="closeModal()" data-lang="cancel">Cancelar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Document Preview Modal -->
  <div class="modal" id="documentModal">
    <div class="modal-content">
      <h3 class="modal-title" id="documentModalTitle">Vista Previa</h3>
      <div id="documentPreview"></div>
      <div class="modal-footer" id="documentModalFooter">
        <button class="btn btn-info" onclick="closeModal()" data-lang="close">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- Info Modal -->
  <div class="modal" id="infoModal">
    <div class="modal-content">
      <h3 class="modal-title" id="infoModalTitle" data-lang="info">Informaci√≥n</h3>
      <p id="infoModalMessage"></p>
      <div class="modal-footer">
        <button class="btn btn-info" onclick="closeModal()" data-lang="accept">Aceptar</button>
      </div>
    </div>
  </div>



  <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
  import { 
    getFirestore, 
    collection, 
    getDocs, 
    query, 
    where,
    doc,
    getDoc,
    updateDoc,
    setDoc
  } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js";

  // Firebase Configuration (Move to backend in production)
  const firebaseConfig = {
    apiKey: "AIzaSyDLi-egzQlgbKW8XV_qIhU6313Gd8gocCg",
    authDomain: "inventario-35d6b.firebaseapp.com",
    databaseURL: "https://inventario-35d6b-default-rtdb.firebaseio.com",
    projectId: "inventario-35d6b",
    storageBucket: "inventario-35d6b.appspot.com",
    messagingSenderId: "266100399659",
    appId: "1:266100399659:web:92358d28cbd803c8a7d46e"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const { jsPDF } = window.jspdf;

  // Global Variables
  let currentUser = null;
  let currentLoan = null;
  let paymentReceipts = [];
  let userSettings = {
    theme: 'dark',
    customColor: '#15a086',
    language: 'es',
    emailNotifications: true,
    smsNotifications: false,
    fontSize: 'medium',
    currency: 'USD'
  };
  const isPC = window.innerWidth > 768 && !/Mobi|Android/i.test(navigator.userAgent);

  // Language Translations
  const translations = {
    es: {
      login: 'Iniciar Sesi√≥n',
      view_details: 'Ver Detalles',
      loan_balance: 'Saldo Pendiente',
      loan_progress: 'Progreso del Pr√©stamo',
      loading_progress: 'Cargando progreso...',
      payment_history: 'Historial de Pagos',
      loading_history: 'Cargando historial de pagos...',
      all: 'Todos',
      full: 'Completo',
      capital: 'Capital',
      interest: 'Inter√©s',
      late: 'Con Mora',
      my_profile: 'Mi Perfil',
      full_name: 'Nombre completo',
      id: 'Identificaci√≥n',
      phone: 'Tel√©fono',
      address: 'Direcci√≥n',
      nationality: 'Nacionalidad',
      reference: 'Referencia personal',
      change_profile_picture: 'Cambiar Foto de Perfil',
      change_password: 'Cambiar Contrase√±a',
      current_pin: 'PIN Actual',
      new_pin: 'Nuevo PIN',
      confirm_pin: 'Confirmar Nuevo PIN',
      logout: 'Cerrar Sesi√≥n',
      my_documents: 'Mis Documentos',
      no_documents: 'No hay documentos disponibles',
      settings: 'Configuraci√≥n',
      app_theme: 'Tema de la Aplicaci√≥n',
      dark: 'Oscuro',
      light: 'Claro',
      custom: 'Personalizado',
      custom_color: 'Color Personalizado',
      language: 'Idioma',
      spanish: 'Espa√±ol',
      english: 'English',
      notifications: 'Notificaciones',
      email_notifications: 'Notificaciones por Email',
      sms_notifications: 'Notificaciones por SMS',
      font_size: 'Tama√±o de Fuente',
      small: 'Peque√±o',
      medium: 'Mediano',
      large: 'Grande',
      currency: 'Formato de Moneda',
      usd: 'USD',
      dop: 'DOP',
      save_settings: 'Guardar Configuraci√≥n',
      home: 'Inicio',
      history: 'Historial',
      profile: 'Perfil',
      documents: 'Documentos',
      loan_details: 'Detalles del Pr√©stamo',
      select_profile_picture: 'Seleccionar Foto de Perfil',
      upload_image: 'Subir Imagen',
      save: 'Guardar',
      cancel: 'Cancelar',
      close: 'Cerrar',
      accept: 'Aceptar',
      info: 'Informaci√≥n',
      download: 'Descargar',
      no_payments: 'No hay pagos registrados',
      no_matching_payments: 'No se encontraron pagos que coincidan con los criterios',
      loan_completed: '¬°Pr√©stamo pagado completamente!',
      payment_due: 'Pr√≥ximo pago en {days} d√≠as',
      payment_late: 'Pago atrasado por {days} d√≠as',
      late_payment_alert: '¬°Atenci√≥n! Tiene un pago atrasado por {days} d√≠as',
      progress: '{percent}% completado',
      recommendation_letter: 'Carta de Recomendaci√≥n',
      original_amount: 'Monto original',
      interest_rate: 'Tasa de inter√©s',
      frequency: 'Frecuencia',
      next_payment: 'Pr√≥ximo pago',
      next_payment_amount: 'Monto pr√≥ximo pago',
      payments_made: 'Pagos realizados',
      payments_pending: 'Pagos pendientes',
      biweekly: 'Quincenal',
      monthly: 'Mensual',
      completed: 'Completado',
      status: 'Estado'
    },
    en: {
      login: 'Log In',
      view_details: 'View Details',
      loan_balance: 'Outstanding Balance',
      loan_progress: 'Loan Progress',
      loading_progress: 'Loading progress...',
      payment_history: 'Payment History',
      loading_history: 'Loading payment history...',
      all: 'All',
      full: 'Full',
      capital: 'Capital',
      interest: 'Interest',
      late: 'With Late Fee',
      my_profile: 'My Profile',
      full_name: 'Full Name',
      id: 'Identification',
      phone: 'Phone',
      address: 'Address',
      nationality: 'Nationality',
      reference: 'Personal Reference',
      change_profile_picture: 'Change Profile Picture',
      change_password: 'Change Password',
      current_pin: 'Current PIN',
      new_pin: 'New PIN',
      confirm_pin: 'Confirm New PIN',
      logout: 'Log Out',
      my_documents: 'My Documents',
      no_documents: 'No documents available',
      settings: 'Settings',
      app_theme: 'App Theme',
      dark: 'Dark',
      light: 'Light',
      custom: 'Custom',
      custom_color: 'Custom Color',
      language: 'Language',
      spanish: 'Spanish',
      english: 'English',
      notifications: 'Notifications',
      email_notifications: 'Email Notifications',
      sms_notifications: 'SMS Notifications',
      font_size: 'Font Size',
      small: 'Small',
      medium: 'Medium',
      large: 'Large',
      currency: 'Currency Format',
      usd: 'USD',
      dop: 'DOP',
      save_settings: 'Save Settings',
      home: 'Home',
      history: 'History',
      profile: 'Profile',
      documents: 'Documents',
      loan_details: 'Loan Details',
      select_profile_picture: 'Select Profile Picture',
      upload_image: 'Upload Image',
      save: 'Save',
      cancel: 'Cancel',
      close: 'Close',
      accept: 'Accept',
      info: 'Information',
      download: 'Download',
      no_payments: 'No payments registered',
      no_matching_payments: 'No payments found matching the criteria',
      loan_completed: 'Loan fully paid!',
      payment_due: 'Next payment in {days} days',
      payment_late: 'Payment overdue by {days} days',
      late_payment_alert: 'Attention! You have a payment overdue by {days} days',
      progress: '{percent}% completed',
      recommendation_letter: 'Recommendation Letter',
      original_amount: 'Original Amount',
      interest_rate: 'Interest Rate',
      frequency: 'Frequency',
      next_payment: 'Next Payment',
      next_payment_amount: 'Next Payment Amount',
      payments_made: 'Payments Made',
      payments_pending: 'Payments Pending',
      biweekly: 'Biweekly',
      monthly: 'Monthly',
      completed: 'Completed',
      status: 'Status'
    }
  };

  // Initialization
  document.addEventListener('DOMContentLoaded', () => {
    showLoading();
    setupEventListeners();
    loadUserSettings().then(() => hideLoading());
  });

  // Setup Event Listeners
  function setupEventListeners() {
    document.getElementById('loginForm').addEventListener('submit', handleLogin);
    document.querySelectorAll('.nav-item').forEach(item => {
      item.addEventListener('click', (e) => {
        e.preventDefault();
        navigateToSection(item.dataset.section);
      });
    });
    document.getElementById('detailsBtn').addEventListener('click', showLoanDetails);
    document.getElementById('historySearch').addEventListener('input', filterPaymentHistory);
    document.getElementById('historyFilter').addEventListener('change', filterPaymentHistory);
    document.getElementById('changeAvatarBtn').addEventListener('click', showAvatarModal);
    document.getElementById('saveAvatarBtn').addEventListener('click', saveAvatar);
    document.getElementById('profileImageUpload').addEventListener('change', handleImageUpload);
    document.getElementById('changePasswordBtn').addEventListener('click', showPasswordModal);
    document.getElementById('passwordForm').addEventListener('submit', changePassword);
    document.getElementById('logoutBtn').addEventListener('click', logout);
    document.querySelectorAll('.theme-option').forEach(option => {
      option.addEventListener('click', selectTheme);
    });
    document.getElementById('customColorPicker').addEventListener('input', updateCustomColor);
    document.getElementById('languageSelector').addEventListener('change', updateLanguage);
    document.getElementById('fontSizeSelector').addEventListener('change', updateFontSize);
    document.getElementById('currencySelector').addEventListener('change', updateCurrency);
    document.getElementById('emailNotifications').addEventListener('change', updateNotifications);
    document.getElementById('smsNotifications').addEventListener('change', updateNotifications);
    document.getElementById('saveSettingsBtn').addEventListener('click', saveSettings);
  }

  // Handle Login
  async function handleLogin(e) {
    e.preventDefault();
    const username = document.getElementById('loginUsername').value.trim();
    const pin = document.getElementById('loginPin').value.trim();
    
    if (!username || !pin || pin.length !== 4 || !/^\d{4}$/.test(pin)) {
      showAlert(translate('Credenciales inv√°lidas o PIN no v√°lido'), 'danger', 'loginAlert');
      return;
    }

    showLoading();
    try {
      const q = query(collection(db, "LoanUsers"), where("username", "==", username), where("pin", "==", pin));
      const querySnapshot = await getDocs(q);
      
      if (querySnapshot.empty) {
        showAlert(translate('Credenciales incorrectas'), 'danger', 'loginAlert');
        hideLoading();
        return;
      }

      const userDoc = querySnapshot.docs[0];
      currentUser = { id: userDoc.id, ...userDoc.data() };

      // Load user settings from Firestore
      await loadUserSettings();

      if (currentUser.loanIds && currentUser.loanIds.length > 0) {
        const loanId = currentUser.loanIds[0];
        const loanRef = doc(db, "Loans", loanId);
        const loanSnap = await getDoc(loanRef);

        if (!loanSnap.exists()) {
          showAlert(translate('No se encontr√≥ informaci√≥n del pr√©stamo'), 'danger', 'loginAlert');
          hideLoading();
          return;
        }

        currentLoan = { id: loanSnap.id, ...loanSnap.data() };
        showClientSection();
        loadClientData();
      } else {
        showAlert(translate('No se encontr√≥ pr√©stamo asociado a este usuario'), 'danger', 'loginAlert');
      }
    } catch (error) {
      console.error("Error al iniciar sesi√≥n: ", error);
      showAlert(translate('Ocurri√≥ un error al iniciar sesi√≥n'), 'danger', 'loginAlert');
    } finally {
      hideLoading();
    }
  }

  // Show Client Section
  function showClientSection() {
    document.getElementById('login-section').style.display = 'none';
    document.getElementById('client-section').style.display = 'block';
    navigateToSection('summary');
  }

  // Load Client Data
  function loadClientData() {
    document.getElementById('clientName').textContent = currentLoan.client.name;
    document.getElementById('clientId').textContent = `ID: ${currentLoan.client.id}`;
    updateBalanceDisplay();

    const paymentsMade = currentLoan.payments ? currentLoan.payments.length : 0;
    const totalPayments = currentLoan.paymentSchedule.length;
    const progress = (paymentsMade / totalPayments) * 100;
    document.getElementById('progressFill').style.width = `${progress}%`;

    if (currentUser.avatar) {
      const avatarDiv = document.getElementById('clientAvatar');
      avatarDiv.innerHTML = currentUser.avatar.includes('<i') ? currentUser.avatar : `<img src="${currentUser.avatar}" alt="Avatar" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`;
    }

    loadLoanProgress();
    loadPaymentHistory();
    loadProfileData();
    loadDocuments();
  }

  // Update Balance Display
  function updateBalanceDisplay() {
    const balance = currentLoan.balance.toFixed(2);
    const currencySymbol = userSettings.currency === 'USD' ? '$' : 'RD$';
    document.getElementById('loanBalance').textContent = `${currencySymbol}${balance}`;
  }

  // Show Loan Details in Modal
  function showLoanDetails() {
    const nextPayment = currentLoan.paymentSchedule.find(p => p.status === 'pending');
    const paymentsMade = currentLoan.payments ? currentLoan.payments.length : 0;
    const totalPayments = currentLoan.paymentSchedule.length;
    const currencySymbol = userSettings.currency === 'USD' ? '$' : 'RD$';

    const content = `
      <div class="loan-summary-item">
        <span class="loan-detail-label" data-lang="original_amount">${translate('original_amount')}:</span>
        <span>${currencySymbol}${currentLoan.amount.toFixed(2)}</span>
      </div>
      <div class="loan-summary-item">
        <span class="loan-detail-label" data-lang="interest_rate">${translate('interest_rate')}:</span>
        <span>${currentLoan.interestRate}%</span>
      </div>
      <div class="loan-summary-item">
        <span class="loan-detail-label" data-lang="frequency">${translate('frequency')}:</span>
        <span data-lang="${currentLoan.frequency === 'biweekly' ? 'biweekly' : 'monthly'}">${translate(currentLoan.frequency === 'biweekly' ? 'biweekly' : 'monthly')}</span>
      </div>
      <div class="loan-summary-item">
        <span class="loan-detail-label" data-lang="next_payment">${translate('next_payment')}:</span>
        <span>${nextPayment ? new Date(nextPayment.dueDate).toLocaleDateString() : 'N/A'}</span>
      </div>
      <div class="loan-summary-item">
        <span class="loan-detail-label" data-lang="next_payment_amount">${translate('next_payment_amount')}:</span>
        <span>${nextPayment ? `${currencySymbol}${nextPayment.amount.toFixed(2)}` : 'N/A'}</span>
      </div>
      <div class="loan-summary-item">
        <span class="loan-detail-label" data-lang="payments_made">${translate('payments_made')}:</span>
        <span>${paymentsMade}</span>
      </div>
      <div class="loan-summary-item">
        <span class="loan-detail-label" data-lang="payments_pending">${translate('payments_pending')}:</span>
        <span>${totalPayments - paymentsMade}</span>
      </div>
    `;
    document.getElementById('loanDetailsContent').innerHTML = content;
    document.getElementById('detailsModal').classList.add('active');
    updateLanguage();
  }

  // Load Loan Progress
  function loadLoanProgress() {
    const container = document.getElementById('loanProgress');
    const paymentsMade = currentLoan.payments ? currentLoan.payments.length : 0;
    const totalPayments = currentLoan.paymentSchedule.length;
    const progress = (paymentsMade / totalPayments) * 100;

    let statusHTML = '';
    if (currentLoan.balance <= 0) {
      statusHTML = `
        <div class="alert alert-success">
          <i class="fas fa-check-circle"></i>
          <span data-lang="loan_completed">${translate('loan_completed')}</span>
        </div>
        <div class="loan-summary-item">
          <span class="loan-detail-label" data-lang="status">${translate('status')}:</span>
          <span data-lang="completed">${translate('completed')}</span>
        </div>
      `;
      document.getElementById('latePaymentAlert').style.display = 'none';
      document.getElementById('latePaymentText').style.display = 'none';
    } else {
      const nextPayment = currentLoan.paymentSchedule.find(p => p.status === 'pending');
      const today = new Date();
      let statusClass = '';
      let message = '';

      if (nextPayment) {
        const dueDate = new Date(nextPayment.dueDate);
        const daysUntilDue = Math.floor((dueDate - today) / (1000 * 60 * 60 * 24));
        if (daysUntilDue < 0) {
          statusClass = 'alert-danger';
          message = translate('payment_late').replace('{days}', -daysUntilDue);
          document.getElementById('latePaymentAlert').style.display = 'flex';
          document.getElementById('latePaymentMessage').textContent = translate('late_payment_alert').replace('{days}', -daysUntilDue);
          document.getElementById('latePaymentText').style.display = 'block';
          document.getElementById('latePaymentText').textContent = translate('payment_late').replace('{days}', -daysUntilDue);
        } else {
          statusClass = daysUntilDue <= 5 ? 'alert-warning' : 'alert-success';
          message = translate('payment_due').replace('{days}', daysUntilDue);
          document.getElementById('latePaymentAlert').style.display = 'none';
          document.getElementById('latePaymentText').style.display = 'none';
        }
      } else {
        statusClass = 'alert-success';
        message = translate('Todos los pagos est√°n al d√≠a');
        document.getElementById('latePaymentAlert').style.display = 'none';
        document.getElementById('latePaymentText').style.display = 'none';
      }

      statusHTML = `
        <div class="alert ${statusClass}">
          <i class="fas fa-info-circle"></i>
          <span>${message}</span>
        </div>
        <div class="loan-summary-item">
          <span class="loan-detail-label" data-lang="progress">${translate('progress').replace('{percent}', '')}:</span>
          <span data-lang="progress" data-progress="${progress.toFixed(0)}">${translate('progress').replace('{percent}', progress.toFixed(0))}</span>
        </div>
      `;
    }

    container.innerHTML = statusHTML;
    updateLanguage();
  }

  // Load Payment History
  function loadPaymentHistory() {
    const container = document.getElementById('paymentHistory');
    paymentReceipts = [];

    if (!currentLoan.payments || currentLoan.payments.length === 0) {
      container.innerHTML = `
        <div class="alert alert-warning">
          <i class="fas fa-exclamation-circle"></i>
          <span data-lang="no_payments">${translate('no_payments')}</span>
        </div>
      `;
      return;
    }

    container.innerHTML = '';
    const sortedPayments = [...currentLoan.payments].sort((a, b) => b.date.toDate() - a.date.toDate());

    sortedPayments.forEach(payment => {
      const paymentDate = payment.date.toDate();
      const typeClass = payment.lateFee && payment.lateFee > 0 ? 'late' : payment.type;
      const typeText = getPaymentTypeText(payment.type) + (payment.lateFee && payment.lateFee > 0 ? ` ${translate('late')}` : '');
      const currencySymbol = userSettings.currency === 'USD' ? '$' : 'RD$';

      paymentReceipts.push({
        id: `${currentLoan.id}_${paymentDate.toISOString()}`,
        clientName: currentLoan.client.name,
        clientId: currentLoan.client.id,
        loanId: currentLoan.id,
        date: paymentDate,
        amount: payment.amount,
        type: payment.type,
        lateFee: payment.lateFee || 0,
        recordedBy: payment.recordedBy || translate('Administrador')
      });

      const paymentItem = document.createElement('div');
      paymentItem.className = 'payment-item';
      paymentItem.innerHTML = `
        <div>
          <div class="payment-amount">${currencySymbol}${payment.amount.toFixed(2)}</div>
          <div class="payment-date">${paymentDate.toLocaleDateString()} ${paymentDate.toLocaleTimeString()}</div>
        </div>
        <div>
          <span class="payment-type ${typeClass}">${typeText}</span>
        </div>
      `;
      container.appendChild(paymentItem);
    });
    updateLanguage();
  }

  // Filter Payment History
  function filterPaymentHistory() {
    const searchTerm = document.getElementById('historySearch').value.toLowerCase();
    const filterType = document.getElementById('historyFilter').value;
    const container = document.getElementById('paymentHistory');

    if (!currentLoan.payments || currentLoan.payments.length === 0) {
      container.innerHTML = `
        <div class="alert alert-warning">
          <i class="fas fa-exclamation-circle"></i>
          <span data-lang="no_payments">${translate('no_payments')}</span>
        </div>
      `;
      return;
    }

    const sortedPayments = [...currentLoan.payments].sort((a, b) => b.date.toDate() - a.date.toDate());
    const filteredPayments = sortedPayments.filter(payment => {
      const paymentDate = payment.date.toDate().toLocaleDateString().toLowerCase();
      const isDateMatch = searchTerm ? paymentDate.includes(searchTerm) : true;
      const isTypeMatch = filterType === 'all' || 
                         (filterType === 'late' && payment.lateFee && payment.lateFee > 0) || 
                         (filterType !== 'late' && payment.type === filterType);
      return isDateMatch && isTypeMatch;
    });

    container.innerHTML = '';
    if (filteredPayments.length === 0) {
      container.innerHTML = `
        <div class="alert alert-warning">
          <i class="fas fa-exclamation-circle"></i>
          <span data-lang="no_matching_payments">${translate('no_matching_payments')}</span>
        </div>
      `;
      return;
    }

    filteredPayments.forEach(payment => {
      const paymentDate = payment.date.toDate();
      const typeClass = payment.lateFee && payment.lateFee > 0 ? 'late' : payment.type;
      const typeText = getPaymentTypeText(payment.type) + (payment.lateFee && payment.lateFee > 0 ? ` ${translate('late')}` : '');
      const currencySymbol = userSettings.currency === 'USD' ? '$' : 'RD$';

      const paymentItem = document.createElement('div');
      paymentItem.className = 'payment-item';
      paymentItem.innerHTML = `
        <div>
          <div class="payment-amount">${currencySymbol}${payment.amount.toFixed(2)}</div>
          <div class="payment-date">${paymentDate.toLocaleDateString()} ${paymentDate.toLocaleTimeString()}</div>
        </div>
        <div>
          <span class="payment-type ${typeClass}">${typeText}</span>
        </div>
      `;
      container.appendChild(paymentItem);
    });
    updateLanguage();
  }

  // Get Payment Type Text
  function getPaymentTypeText(type) {
    const types = {
      full: translate('full'),
      interest: translate('interest'),
      capital: translate('capital')
    };
    return types[type] || type;
  }

  // Load Profile Data
  function loadProfileData() {
    document.getElementById('profileName').textContent = currentLoan.client.name;
    document.getElementById('profileId').textContent = currentLoan.client.id;
    document.getElementById('profilePhone').textContent = currentLoan.client.phone || '-';
    document.getElementById('profileAddress').textContent = currentLoan.client.address || '-';
    document.getElementById('profileNationality').textContent = currentLoan.client.nationality || '-';
    document.getElementById('profileReference').textContent = 
      currentLoan.client.reference ? 
      `${currentLoan.client.reference.name} (${currentLoan.client.reference.relation}) - ${currentLoan.client.reference.phone}` : 
      '-';
    updateLanguage();
  }

  // Show Avatar Modal
  function showAvatarModal() {
    const avatarSelector = document.getElementById('avatarSelector');
    avatarSelector.innerHTML = '';

    const icons = [
      'fa-user', 'fa-user-tie', 'fa-user-astronaut', 'fa-user-ninja', 'fa-user-secret',
      'fa-user-doctor', 'fa-user-graduate', 'fa-user-shield', 'fa-user-cog', 'fa-user-clock',
      'fa-robot', 'fa-cat', 'fa-dog', 'fa-fish', 'fa-dragon',
      'fa-smile', 'fa-heart', 'fa-star', 'fa-moon', 'fa-sun', 'fa-tree', 'fa-leaf',
      'fa-rocket', 'fa-camera'
    ];

    icons.forEach(icon => {
      const avatarOption = document.createElement('div');
      avatarOption.className = `avatar-option ${currentUser.avatar === `<i class="fas ${icon}"></i>` ? 'selected' : ''}`;
      avatarOption.innerHTML = `<i class="fas ${icon}"></i>`;
      avatarOption.dataset.avatar = `<i class="fas ${icon}"></i>`;
      avatarOption.addEventListener('click', selectAvatar);
      avatarSelector.appendChild(avatarOption);
    });

    document.getElementById('profileImageUpload').value = '';
    document.getElementById('avatarModal').classList.add('active');
    updateLanguage();
  }

  // Select Avatar
  function selectAvatar(e) {
    document.querySelectorAll('.avatar-option').forEach(option => {
      option.classList.remove('selected');
    });
    e.currentTarget.classList.add('selected');
    currentUser.avatar = e.currentTarget.dataset.avatar;
  }

  // Handle Image Upload
  function handleImageUpload(e) {
    const file = e.target.files[0];
    if (file && file.type.startsWith('image/')) {
      const reader = new FileReader();
      reader.onload = (event) => {
        currentUser.avatar = event.target.result;
        document.querySelectorAll('.avatar-option').forEach(option => {
          option.classList.remove('selected');
        });
      };
      reader.readAsDataURL(file);
    } else {
      showInfoModal(translate('info'), translate('Por favor, seleccione una imagen v√°lida'));
    }
  }

  // Save Avatar
  async function saveAvatar() {
    if (!currentUser.avatar) {
      showInfoModal(translate('info'), translate('Por favor, seleccione un avatar o suba una imagen'));
      return;
    }

    showLoading();
    try {
      const avatarDiv = document.getElementById('clientAvatar');
      if (currentUser.avatar.startsWith('data:image')) {
        // For production, upload to Firebase Storage and save URL
        /*
        import { getStorage, ref, uploadBytes, getDownloadURL } from "firebase/storage";
        const storage = getStorage();
        const storageRef = ref(storage, `avatars/${currentUser.id}`);
        const response = await fetch(currentUser.avatar);
        const blob = await response.blob();
        await uploadBytes(storageRef, blob);
        const url = await getDownloadURL(storageRef);
        currentUser.avatar = url;
        */
        avatarDiv.innerHTML = `<img src="${currentUser.avatar}" alt="Avatar" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`;
      } else {
        avatarDiv.innerHTML = currentUser.avatar;
      }

      const userRef = doc(db, "LoanUsers", currentUser.id);
      await updateDoc(userRef, { avatar: currentUser.avatar });
      closeModal();
      showInfoModal(translate('info'), translate('Foto de perfil guardada correctamente'));
    } catch (error) {
      console.error("Error al guardar avatar: ", error);
      showInfoModal(translate('info'), translate('No se pudo guardar la imagen de perfil'));
    } finally {
      hideLoading();
    }
  }

  // Show Password Modal
  function showPasswordModal() {
    document.getElementById('passwordForm').reset();
    document.getElementById('passwordAlert').style.display = 'none';
    document.getElementById('passwordModal').classList.add('active');
    updateLanguage();
  }

  // Change Password
  async function changePassword(e) {
    e.preventDefault();
    const currentPin = document.getElementById('currentPin').value.trim();
    const newPin = document.getElementById('newPin').value.trim();
    const confirmPin = document.getElementById('confirmPin').value.trim();

    if (!currentPin || !newPin || !confirmPin || newPin.length !== 4 || !/^\d{4}$/.test(newPin)) {
      showAlert(translate('Por favor, ingrese un PIN v√°lido de 4 d√≠gitos'), 'danger', 'passwordAlert');
      return;
    }

    if (newPin !== confirmPin) {
      showAlert(translate('Los nuevos PIN no coinciden'), 'danger', 'passwordAlert');
      return;
    }

    if (currentPin !== currentUser.pin) {
      showAlert(translate('El PIN actual es incorrecto'), 'danger', 'passwordAlert');
      return;
    }

    showLoading();
    try {
      const userRef = doc(db, "LoanUsers", currentUser.id);
      await updateDoc(userRef, { pin: newPin });
      currentUser.pin = newPin;
      closeModal();
      showInfoModal(translate('info'), translate('Contrase√±a actualizada correctamente'));
    } catch (error) {
      console.error("Error al cambiar contrase√±a: ", error);
      showAlert(translate('No se pudo actualizar la contrase√±a'), 'danger', 'passwordAlert');
    } finally {
      hideLoading();
    }
  }

  // Load Documents
  function loadDocuments() {
    const container = document.getElementById('documentList');
    const alert = document.getElementById('documentsAlert');

    container.innerHTML = '';

    // Add recommendation letter
    const recommendationItem = document.createElement('div');
    recommendationItem.className = 'document-item';
    recommendationItem.innerHTML = `
      <i class="fas fa-file-alt document-icon"></i>
      <span class="document-name" data-lang="recommendation_letter">${translate('recommendation_letter')}</span>
      <i class="fas fa-eye document-action" onclick="previewDocument('recommendation')"></i>
    `;
    container.appendChild(recommendationItem);

    if (!paymentReceipts || paymentReceipts.length === 0) {
      alert.style.display = 'flex';
      return;
    }

    alert.style.display = 'none';

    paymentReceipts.forEach(receipt => {
      const documentItem = document.createElement('div');
      documentItem.className = 'document-item';
      const currencySymbol = userSettings.currency === 'USD' ? '$' : 'RD$';
      documentItem.innerHTML = `
        <i class="fas fa-receipt document-icon"></i>
        <span class="document-name">Recibo ${receipt.date.toLocaleDateString()} - ${currencySymbol}${receipt.amount.toFixed(2)}</span>
        <i class="fas fa-eye document-action" onclick="previewDocument('receipt', '${receipt.id}')"></i>
      `;
      container.appendChild(documentItem);
    });
    updateLanguage();
  }

  // Preview Document
  window.previewDocument = async function(type, receiptId = null) {
    const previewContainer = document.getElementById('documentPreview');
    const modalTitle = document.getElementById('documentModalTitle');
    const modalFooter = document.getElementById('documentModalFooter');
    const currencySymbol = userSettings.currency === 'USD' ? '$' : 'RD$';

    previewContainer.innerHTML = '';
    modalFooter.innerHTML = `<button class="btn btn-info" onclick="closeModal()" data-lang="close">${translate('close')}</button>`;

    if (type === 'recommendation') {
      modalTitle.textContent = translate('recommendation_letter');
      const content = `
        <div class="receipt-preview">
          <h3>${translate('recommendation_letter').toUpperCase()}</h3>
          <p>Por medio de la presente certificamos que el/la se√±or(a) ${currentLoan.client.name} ha cumplido satisfactoriamente con todas sus obligaciones financieras en nuestra instituci√≥n.</p>
          <p><strong>${translate('full_name')}:</strong> ${currentLoan.client.name}</p>
          <p><strong>${translate('id')}:</strong> ${currentLoan.client.id}</p>
          <p><strong>${translate('Fecha')}:</strong> ${new Date().toLocaleDateString()}</p>
        </div>
      `;
      previewContainer.innerHTML = content;

      if (isPC) {
        modalFooter.innerHTML += `
          <button class="btn btn-success" onclick="downloadRecommendationLetter()" data-lang="download">${translate('download')}</button>
        `;
      }
    } else if (type === 'receipt' && receiptId) {
      const receipt = paymentReceipts.find(r => r.id === receiptId);
      if (receipt) {
        modalTitle.textContent = `Recibo ${receipt.date.toLocaleDateString()}`;
        const content = `
          <div class="receipt-preview" id="receiptPreview_${receiptId}">
            <h3>RECIBO DE PAGO</h3>
            <p><strong>${translate('full_name')}:</strong> ${receipt.clientName}</p>
            <p><strong>${translate('id')}:</strong> ${receipt.clientId}</p>
            <p><strong>${translate('Pr√©stamo')}:</strong> ${receipt.loanId}</p>
            <p><strong>${translate('Fecha')}:</strong> ${receipt.date.toLocaleDateString()} ${receipt.date.toLocaleTimeString()}</p>
            <p><strong>${translate('Monto')}:</strong> ${currencySymbol}${receipt.amount.toFixed(2)}</p>
            <p><strong>${translate('Tipo')}:</strong> ${getPaymentTypeText(receipt.type)}</p>
            <p><strong>${translate('Mora')}:</strong> ${currencySymbol}${receipt.lateFee.toFixed(2)}</p>
            <p><strong>${translate('Registrado por')}:</strong> ${receipt.recordedBy}</p>
          </div>
        `;
        previewContainer.innerHTML = content;

        if (isPC) {
          modalFooter.innerHTML += `
            <button class="btn btn-success" onclick="downloadReceipt('${receiptId}')" data-lang="download">${translate('download')}</button>
          `;
        }
      } else {
        showInfoModal(translate('info'), translate('No se encontr√≥ el recibo solicitado'));
        return;
      }
    }

    document.getElementById('documentModal').classList.add('active');
    updateLanguage();
  }

  // Download Receipt
  window.downloadReceipt = async function(receiptId) {
    showLoading();
    try {
      const receipt = paymentReceipts.find(r => r.id === receiptId);
      if (!receipt) {
        showInfoModal(translate('info'), translate('No se encontr√≥ el recibo solicitado'));
        hideLoading();
        return;
      }

      const preview = document.getElementById(`receiptPreview_${receiptId}`);
      const canvas = await html2canvas(preview, { backgroundColor: '#ffffff', scale: 2 });
      const dataUrl = canvas.toDataURL('image/jpeg', 1.0);

      const link = document.createElement('a');
      link.href = dataUrl;
      link.download = `recibo_pago_${receiptId}.jpg`;
      link.click();
      showInfoModal(translate('info'), translate('Recibo descargado exitosamente'));
    } catch (error) {
      console.error("Error al descargar recibo: ", error);
      showInfoModal(translate('info'), translate('Error al descargar el recibo'));
    } finally {
      hideLoading();
    }
  }

  // Download Recommendation Letter
  window.downloadRecommendationLetter = async function() {
    showLoading();
    try {
      const doc = new jsPDF();
      doc.setFont('helvetica', 'normal');
      doc.setFontSize(12);

      const content = `
${translate('recommendation_letter').toUpperCase()}

Por medio de la presente certificamos que el/la se√±or(a) ${currentLoan.client.name} ha cumplido satisfactoriamente con todas sus obligaciones financieras en nuestra instituci√≥n.

${translate('full_name')}: ${currentLoan.client.name}
${translate('id')}: ${currentLoan.client.id}
${translate('Fecha')}: ${new Date().toLocaleDateString()}
      `;

      doc.text(content, 20, 20);
      doc.save(`Carta_Recomendacion_${currentLoan.client.name.replace(/\s+/g, '_')}.pdf`);
      showInfoModal(translate('info'), translate('Carta descargada exitosamente'));
    } catch (error) {
      console.error("Error al descargar carta: ", error);
      showInfoModal(translate('info'), translate('Error al descargar la carta'));
    } finally {
      hideLoading();
    }
  }

  // Select Theme
  function selectTheme(e) {
    document.querySelectorAll('.theme-option').forEach(option => {
      option.classList.remove('selected');
    });
    e.target.classList.add('selected');
    userSettings.theme = e.target.dataset.theme;
    document.getElementById('customColorContainer').style.display = userSettings.theme === 'custom' ? 'block' : 'none';
    applyTheme();
    updateLanguage();
  }

  // Update Custom Color
  function updateCustomColor(e) {
    userSettings.customColor = e.target.value;
    applyTheme();
  }

  // Apply Theme
  function applyTheme() {
    document.body.classList.remove('light-theme');
    document.documentElement.style.setProperty('--primary-color', '#15a086');
    document.documentElement.style.setProperty('--primary-dark', '#127c68');

    if (userSettings.theme === 'light') {
      document.body.classList.add('light-theme');
    } else if (userSettings.theme === 'custom') {
      document.documentElement.style.setProperty('--primary-color', userSettings.customColor);
      document.documentElement.style.setProperty('--primary-dark', darkenColor(userSettings.customColor, 0.8));
      document.getElementById('customColorPicker').value = userSettings.customColor;
    }

    document.querySelectorAll('.theme-option').forEach(option => {
      option.classList.toggle('selected', option.dataset.theme === userSettings.theme);
    });
    document.getElementById('customColorContainer').style.display = userSettings.theme === 'custom' ? 'block' : 'none';
  }

  // Darken Color
  function darkenColor(hex, factor) {
    hex = hex.replace('#', '');
    const r = parseInt(hex.substr(0, 2), 16) * factor;
    const g = parseInt(hex.substr(2, 2), 16) * factor;
    const b = parseInt(hex.substr(4, 2), 16) * factor;
    return `#${Math.round(r).toString(16).padStart(2, '0')}${Math.round(g).toString(16).padStart(2, '0')}${Math.round(b).toString(16).padStart(2, '0')}`;
  }

  // Update Language
  function updateLanguage() {
    userSettings.language = document.getElementById('languageSelector').value;
    document.querySelectorAll('[data-lang]').forEach(element => {
      const key = element.dataset.lang;
      if (element.dataset.progress) {
        element.textContent = translate('progress').replace('{percent}', element.dataset.progress);
      } else {
        element.textContent = translate(key);
      }
    });
  }

  // Update Font Size
  function updateFontSize() {
    userSettings.fontSize = document.getElementById('fontSizeSelector').value;
    document.body.classList.remove('font-small', 'font-medium', 'font-large');
    document.body.classList.add(`font-${userSettings.fontSize}`);
  }

  // Update Currency
  function updateCurrency() {
    userSettings.currency = document.getElementById('currencySelector').value;
    updateBalanceDisplay();
    loadPaymentHistory();
    loadDocuments();
    if (document.getElementById('detailsModal').classList.contains('active')) {
      showLoanDetails();
    }
  }

  // Update Notifications
  function updateNotifications() {
    userSettings.emailNotifications = document.getElementById('emailNotifications').checked;
    userSettings.smsNotifications = document.getElementById('smsNotifications').checked;
  }

  // Save Settings
  async function saveSettings() {
    showLoading();
    try {
      const userRef = doc(db, "LoanUsers", currentUser.id);
      await updateDoc(userRef, { settings: userSettings });
      showInfoModal(translate('info'), translate('Configuraci√≥n guardada correctamente'));
    } catch (error) {
      console.error("Error al guardar ajustes: ", error);
      showInfoModal(translate('info'), translate('No se pudo guardar la configuraci√≥n'));
    } finally {
      hideLoading();
    }
  }

  // Load User Settings
  async function loadUserSettings() {
    try {
      if (currentUser && currentUser.id) {
        const userRef = doc(db, "LoanUsers", currentUser.id);
        const userSnap = await getDoc(userRef);
        if (userSnap.exists() && userSnap.data().settings) {
          userSettings = { ...userSettings, ...userSnap.data().settings };
        }
      }

      document.getElementById('languageSelector').value = userSettings.language;
      document.getElementById('fontSizeSelector').value = userSettings.fontSize;
      document.getElementById('currencySelector').value = userSettings.currency;
      document.getElementById('emailNotifications').checked = userSettings.emailNotifications;
      document.getElementById('smsNotifications').checked = userSettings.smsNotifications;

      applyTheme();
      updateLanguage();
      updateFontSize();
      updateCurrency();
    } catch (error) {
      console.error("Error al cargar ajustes: ", error);
    }
  }

  // Navigate Between Sections
  function navigateToSection(section) {
    document.querySelectorAll('.nav-item').forEach(item => {
      item.classList.toggle('active', item.dataset.section === section);
    });
    document.querySelectorAll('.section').forEach(sec => {
      sec.classList.toggle('active', sec.id === `${section}-section`);
    });
    updateLanguage();
  }

  // Show Alert
  function showAlert(message, type, alertId = 'loginAlert') {
    const alert = document.getElementById(alertId);
    alert.style.display = 'flex';
    alert.className = `alert alert-${type}`;
    document.getElementById(`${alertId}Message`).textContent = message;
  }

  // Show Info Modal
  function showInfoModal(title, message) {
    document.getElementById('infoModalTitle').textContent = title;
    document.getElementById('infoModalMessage').textContent = message;
    document.getElementById('infoModal').classList.add('active');
    updateLanguage();
  }

  // Close Modal
  window.closeModal = function() {
    document.querySelectorAll('.modal').forEach(modal => {
      modal.classList.remove('active');
    });
  };

  // Show Loading
  function showLoading() {
    document.getElementById('loginSpinner').classList.add('active');
  }

  // Hide Loading
  function hideLoading() {
    document.getElementById('loginSpinner').classList.remove('active');
  }

  // Logout
  function logout() {
    currentUser = null;
    currentLoan = null;
    paymentReceipts = [];
    document.getElementById('login-section').style.display = 'flex';
    document.getElementById('client-section').style.display = 'none';
    document.getElementById('loginForm').reset();
    document.getElementById('loginAlert').style.display = 'none';
    applyTheme();
    updateLanguage();
  }

  // Translate Function
  function translate(key) {
    return translations[userSettings.language][key] || key;
  }
</script>
